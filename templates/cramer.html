<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Método de Cramer</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 950px; margin: auto; background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,.08); }
    h1 { text-align: center; margin-bottom: 8px; }
    .subtitle { text-align: center; color: #666; margin-bottom: 25px; }
    .steps-header { display: flex; justify-content: center; gap: 16px; margin-bottom: 25px; }
    .step-circle { width: 34px; height: 34px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-weight: 600; color: #fff; }
    .step-circle.active { background: #4b4bfd; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; }
    input[type="number"], input[type="text"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    .btn { background: #000; color: #fff; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .btn-secondary { background: #fff; color: #000; border: 1px solid #000; }
    .inline-form { display: inline-block; }
    .matrix-table { margin: 20px auto; border-collapse: collapse; }
    .matrix-table td { padding: 4px; }
    .matrix-table input { width: 70px; text-align: center; }
    .error { background: #ffe0e0; color: #b30000; padding: 10px 14px; border-radius: 8px; margin-bottom: 15px; }
    .result-box { background: #d8f3dc; padding: 15px 18px; border-radius: 10px; margin-bottom: 20px; }
    .section-title { font-weight: 700; margin-bottom: 8px; }
    .step-panel { background: #f8f9fb; border-left: 4px solid #4b4bfd; padding: 15px; border-radius: 6px; max-height: 300px; overflow-y: auto; }
    .step-panel ol { padding-left: 20px; }
    .two-columns { display: flex; gap: 20px; flex-wrap: wrap; }
    .col { flex: 1; min-width: 260px; }
    .mini-matrix { background: #fff; border: 1px solid #eee; padding: 8px; border-radius: 6px; margin-bottom: 12px; }
    .bottom-buttons { margin-top: 20px; display: flex; gap: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Método de Cramer</h1>
    <p class="subtitle">Resuelve sistemas 2×2 o 3×3 mostrando el paso a paso.</p>

    <!-- Pasos -->
    <div class="steps-header">
      <div class="step-circle {% if not step %}active{% endif %}">1</div>
      <div class="step-circle {% if step == 'input' %}active{% endif %}">2</div>
      <div class="step-circle {% if step == 'result' %}active{% endif %}">3</div>
    </div>

    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}

    {% if not step %}
    <!-- PASO 1: pedir tamaño -->
    <form method="POST" action="{{ url_for('cramer') }}">
      <div class="form-group">
        <label for="num_unk">Número de incógnitas:</label>
        <input type="number" name="num_unk" id="num_unk" min="2" max="3" placeholder="Ej: 3" required>
      </div>
      <div class="form-group">
        <label for="num_eq">Número de ecuaciones:</label>
        <input type="number" name="num_eq" id="num_eq" min="2" max="3" placeholder="Ej: 3" required>
      </div>
      <button type="submit" class="btn">Continuar</button>
      <a href="{{ url_for('home') }}" class="btn btn-secondary" style="margin-left:10px;">Volver al Menú Principal</a>
    </form>
    {% endif %}

    {% if step == 'input' %}
    <!-- PASO 2: ingresar coeficientes -->
    <form method="POST" action="{{ url_for('cramer') }}">
      <input type="hidden" name="n" value="{{ num_unk }}">
      <input type="hidden" name="num_unk" value="{{ num_unk }}">
      <input type="hidden" name="num_eq" value="{{ num_eq }}">

      <p class="section-title">Ingreso de datos</p>
      <p>Ingresa los coeficientes de la matriz A ({{ num_unk }}×{{ num_unk }}) y el vector b. Acepta fracciones (ej: 3/2).</p>

      <table class="matrix-table">
        {% for i in range(num_unk) %}
        <tr>
          {% for j in range(num_unk) %}
          <td><input type="text" name="A_{{ i }}_{{ j }}" placeholder="a{{ i+1 }}{{ j+1 }}"></td>
          {% endfor %}
          <td>|</td>
          <td><input type="text" name="b_{{ i }}" placeholder="b{{ i+1 }}"></td>
        </tr>
        {% endfor %}
      </table>

      <button type="submit" class="btn">Resolver con Cramer</button>
      <a href="{{ url_for('cramer') }}" class="btn btn-secondary" style="margin-left:10px;">Volver</a>
    </form>
    {% endif %}

    {% if step == 'result' and result %}
      <div class="result-box">
        <p class="section-title">Resultado</p>
        <p>det(A) = {{ result.detA }}</p>
        {% if result.unique %}
          <p>El sistema tiene solución única:</p>
          <ul>
          {% for var, val in result.solutions.items() %}
            <li><strong>{{ var }}</strong> = {{ val }}</li>
          {% endfor %}
          </ul>
        {% else %}
          <p>Como det(A) = 0, el sistema no tiene solución única (puede ser incompatible o con infinitas soluciones).</p>
        {% endif %}
      </div>

      <!-- Mostrar columnas reemplazadas -->
      {% if result.columns %}
      <div class="two-columns">
        {% for col in result.columns %}
        <div class="col">
          <div class="mini-matrix">
            <p><strong>Matriz A{{ col.index }} (columna {{ col.index }} reemplazada por b):</strong></p>
            <table class="matrix-table">
              {% for row in col.matrix %}
              <tr>
                {% for val in row %}
                <td>{{ val }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </table>
            <p>det(A{{ col.index }}) = {{ col.det }}</p>
            <p>x{{ col.index }} = det(A{{ col.index }}) / det(A) = {{ col.det }} / {{ result.detA }} = {{ col.value }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <div class="section-title" style="margin-top:20px;">Paso a paso</div>
      <div class="step-panel">
        <ol>
          {% for s in result.steps %}
          <li>{{ s }}</li>
          {% endfor %}
        </ol>
      </div>

      <div class="bottom-buttons">
        <a href="{{ url_for('cramer') }}" class="btn">Nuevo sistema</a>
        <a href="{{ url_for('home') }}" class="btn btn-secondary">Menú</a>
      </div>
    {% endif %}

  </div>
</body>
</html>
